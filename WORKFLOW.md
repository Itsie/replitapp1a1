# 1aShirt Workflow & Status-System

## √úbersicht

Dieses Dokument beschreibt den kompletten Workflow eines Auftrags von der Erstellung bis zur Abrechnung im 1aShirt Produktionssystem.

---

## üìä Alle Workflow-Status

Das System verwaltet Auftr√§ge durch 9 Status-Stufen:

| Status | Deutsch | Beschreibung | Badge-Farbe | Bereich |
|--------|---------|--------------|-------------|---------|
| `ENTWURF` | Entwurf | Auftrag wird noch bearbeitet (aktuell nicht verwendet) | Grau | Vorbereitung |
| `NEU` | Entwurf | Neuer Auftrag erstellt, wird bearbeitet | Blau (Primary) | Vorbereitung |
| `PRUEFUNG` | Pr√ºfung | Auftrag wird gepr√ºft (aktuell nicht verwendet) | Gelb (Amber) | Vorbereitung |
| `FUER_PROD` | F√ºr Produktion | Bereit f√ºr Produktionsplanung | Dunkelblau | Planung |
| `IN_PROD` | In Produktion | Wird aktuell produziert | Violett | Produktion |
| `WARTET_FEHLTEILE` | Wartet auf Fehlteile | Produktion blockiert wegen fehlender Teile | Orange | Produktion |
| `FERTIG` | Produktion fertig | Produktion abgeschlossen | Gr√ºn (Emerald) | Abschluss |
| `ZUR_ABRECHNUNG` | Ausgabe erfolgt | Ware ausgeliefert, bereit f√ºr Abrechnung | Hellgrau | Abrechnung |
| `ABGERECHNET` | Abgerechnet | Auftrag vollst√§ndig abgerechnet | Grau | Abgeschlossen |

---

## üîÑ Workflow-Durchlauf im Detail

### Phase 1: Auftragserstellung

#### 1Ô∏è‚É£ Neuen Auftrag anlegen

**Aktion:** Benutzer erstellt einen neuen internen Auftrag

**Was passiert:**
```
POST /api/orders
‚Üí Auftrag wird erstellt
‚Üí Automatische Nummer generiert (z.B. INT-2025-1000)
‚Üí Status: NEU
‚Üí Quelle: INTERNAL
```

**Erforderliche Daten:**
- Titel
- Kunde
- Abteilung (TEAMSPORT, TEXTILVEREDELUNG, STICKEREI, DRUCK, SONSTIGES)

**System-Logik:**
```typescript
// Backend: server/storage.ts - createOrder()
const displayOrderNumber = await this.generateDisplayOrderNumber();
// Format: INT-{JAHR}-{LAUFNUMMER}
// Beispiel: INT-2025-1000

const order = await prisma.order.create({
  data: {
    ...orderData,
    source: 'INTERNAL',
    workflow: 'NEU',
    displayOrderNumber,
  }
});
```

---

### Phase 2: Auftragsvorbereitung

#### 2Ô∏è‚É£ Daten erfassen

**Status bleibt:** `NEU`

**Erforderliche Schritte:**

##### A) Positionen anlegen
- Mindestens **1 Position** erforderlich
- Position = Produkt/Artikel im Auftrag

##### B) F√ºr TEAMSPORT-Abteilung:
1. **Gr√∂√üentabelle erfassen**
   - Schema w√§hlen (ALPHA, NUMERIC, CUSTOM)
   - Gr√∂√üen, Nummern, Namen eintragen
   - Tab "Gr√∂√üentabelle" im Auftrag

2. **Druckdateien hochladen**
   - Mindestens **1 PRINT-Asset** hochladen
   - **WICHTIG:** H√§kchen "Erforderlich f√ºr Freigabe" setzen!
   - Tab "Druckdaten / Anh√§nge" im Auftrag

##### C) F√ºr andere Abteilungen:
- Mindestens **1 Position** erforderlich
- Gr√∂√üentabelle optional
- Assets optional

---

### Phase 3: In Produktion geben

#### 3Ô∏è‚É£ Auftrag freigeben (Submit)

**Aktion:** Button "In Produktion geben" klicken

**Status-Wechsel:** `NEU` ‚Üí `FUER_PROD`

**Validierung (automatisch):**

```typescript
// Backend: server/storage.ts - submitOrder()

// 1. Mindestens eine Position vorhanden?
if (!order.positions || order.positions.length === 0) {
  throw new Error('At least one position is required');
}

// 2. F√ºr TEAMSPORT: Gr√∂√üentabelle vorhanden?
if (order.department === 'TEAMSPORT') {
  if (!order.sizeTable) {
    throw new Error('Size table required for TEAMSPORT department');
  }
  
  // 3. F√ºr TEAMSPORT: Mind. 1 erforderliches PRINT-Asset?
  const hasPrintAsset = order.orderAssets.some(
    asset => asset.kind === 'PRINT' && asset.required && (asset.path || asset.url)
  );
  if (!hasPrintAsset) {
    throw new Error('At least one PRINT asset (path or upload) is required for TEAMSPORT department');
  }
}

// Alle Checks bestanden ‚Üí Status √§ndern
await prisma.order.update({
  where: { id: orderId },
  data: { workflow: 'FUER_PROD' }
});
```

**M√∂gliche Fehler:**
- ‚ùå "At least one position is required"
- ‚ùå "Size table required for TEAMSPORT department"
- ‚ùå "At least one PRINT asset (path or upload) is required for TEAMSPORT department"

**Nach erfolgreicher Freigabe:**
- Auftrag erscheint in der Produktionsplanung
- Kann jetzt TimeSlots zugewiesen werden

---

### Phase 4: Produktionsplanung

#### 4Ô∏è‚É£ TimeSlots erstellen

**Wer:** Produktionsplaner (Rolle: PROD_PLAN oder ADMIN)

**Wo:** Seite "Planung" oder "Produktion"

**Status bleibt:** `FUER_PROD`

**Was wird geplant:**
```
POST /api/timeslots
‚Üí Datum w√§hlen (z.B. 28.10.2025)
‚Üí Uhrzeit w√§hlen (07:00-18:00, 5-Minuten-Raster)
‚Üí Bereich w√§hlen (z.B. "Druck-Station 1")
‚Üí Auftrag zuweisen
‚Üí TimeSlot Status: PLANNED
```

**Kapazit√§ts-Validierung:**
- Jeder Bereich hat eine maximale Parallelkapazit√§t (Standard: 2)
- Regul√§re TimeSlots belegen 1 Kapazit√§t
- Blocker belegen volle Kapazit√§t
- System pr√ºft bei Erstellung: Kapazit√§t √ºberschritten? ‚Üí HTTP 422 Fehler

**Beispiel:**
```typescript
// Bereich: Druck-Station 1 (Kapazit√§t: 2)
// 28.10.2025, 08:00-10:00

TimeSlot 1: FC Bayern Trikots (belegt 1 Kapazit√§t)
TimeSlot 2: Hoodies mit Logo (belegt 1 Kapazit√§t)
‚Üí Kapazit√§t ausgelastet! ‚úÖ

TimeSlot 3: Weitere Auftrag ‚Üí FEHLER: Kapazit√§t √ºberschritten! ‚ùå
```

---

### Phase 5: Produktion starten

#### 5Ô∏è‚É£ TimeSlot starten

**Wer:** Produktionsmitarbeiter (Rolle: PROD_RUN oder ADMIN)

**Wo:** Seite "Produktion" (heute/morgen)

**Aktion:** Play-Button (‚ñ∂Ô∏è) klicken

**Status-Wechsel:**
- TimeSlot: `PLANNED` ‚Üí `RUNNING`
- **Auftrag:** `FUER_PROD` ‚Üí `IN_PROD` (automatisch beim ersten Start!)

**System-Logik:**
```typescript
// Backend: server/storage.ts - startTimeSlot()

// Validierung
if (slot.status !== 'PLANNED' && slot.status !== 'PAUSED') {
  throw new Error('TimeSlot kann nur aus Status PLANNED oder PAUSED gestartet werden');
}

// TimeSlot starten
await prisma.timeSlot.update({
  where: { id },
  data: {
    status: 'RUNNING',
    startedAt: slot.status === 'PLANNED' ? new Date() : slot.startedAt,
  }
});

// WICHTIG: Auftrag-Status wird automatisch auf IN_PROD gesetzt
// (beim ersten TimeSlot-Start)
```

**Was wird gespeichert:**
- Startzeitpunkt (`startedAt`)
- Status RUNNING
- Live-Timer l√§uft in der Oberfl√§che

---

### Phase 6: Produktion l√§uft

#### 6Ô∏è‚É£ W√§hrend der Produktion

**Status:** 
- TimeSlot: `RUNNING`
- Auftrag: `IN_PROD`

**M√∂gliche Aktionen:**

##### A) Pause
```
POST /api/timeslots/:id/pause
‚Üí TimeSlot: RUNNING ‚Üí PAUSED
‚Üí Kann sp√§ter fortgesetzt werden (wieder starten)
‚Üí Auftrag bleibt: IN_PROD
```

##### B) Stopp (Fertigstellen)
```
POST /api/timeslots/:id/stop
‚Üí TimeSlot: RUNNING/PAUSED ‚Üí DONE
‚Üí Stopzeitpunkt wird gespeichert (stoppedAt)
‚Üí Automatische Pr√ºfung: Alle TimeSlots DONE? ‚Üí Auftrag wird fertig!
```

**Auto-Complete-Logik:**
```typescript
// Backend: server/storage.ts - checkAndCompleteOrder()

async function checkAndCompleteOrder(orderId: string) {
  const order = await prisma.order.findUnique({
    where: { id: orderId },
    include: { timeSlots: true }
  });
  
  // Alle TimeSlots DONE?
  const allDone = order.timeSlots.every(slot => slot.status === 'DONE');
  
  // Keine blockierten TimeSlots?
  const hasBlocked = order.timeSlots.some(slot => slot.status === 'BLOCKED');
  
  // Automatisch auf FERTIG setzen!
  if (allDone && !hasBlocked && order.workflow !== 'FERTIG') {
    await prisma.order.update({
      where: { id: orderId },
      data: { workflow: 'FERTIG' }
    });
  }
}
```

##### C) Qualit√§tskontrolle
```
POST /api/timeslots/:id/qc
‚Üí QC-Status setzen: IO (in Ordnung) oder NIO (nicht in Ordnung)
‚Üí Nur m√∂glich wenn TimeSlot Status = DONE
```

---

### Phase 7: Problem - Fehlteile

#### 7Ô∏è‚É£ Fehlende Teile melden

**Wann:** Produktion kann nicht fortgesetzt werden

**Aktion:** Button "Problem melden" ‚Üí "Fehlteile"

**Dialog-Optionen:**
- Notiz zu fehlenden Teilen eingeben
- H√§kchen: "Auftragsstatus auf WARTET_FEHLTEILE √§ndern"

**Status-Wechsel:**
```
POST /api/timeslots/:id/missing-parts
‚Üí TimeSlot: ‚Üí BLOCKED
‚Üí Auftrag: IN_PROD ‚Üí WARTET_FEHLTEILE (wenn H√§kchen gesetzt)
‚Üí Notiz wird gespeichert (missingPartsNote)
```

**System-Logik:**
```typescript
// Backend: server/storage.ts - setTimeSlotMissingParts()

await prisma.timeSlot.update({
  where: { id },
  data: {
    missingPartsNote: note,
    status: 'BLOCKED',
  }
});

// Optional: Auftrag blockieren
if (updateOrderWorkflow) {
  await prisma.order.update({
    where: { id: slot.orderId },
    data: { workflow: 'WARTET_FEHLTEILE' }
  });
}
```

**Seite "Fehlteile-Management":**
- Zeigt alle Auftr√§ge mit Status WARTET_FEHLTEILE
- Button "Freigeben" ‚Üí Auftrag zur√ºck zu FUER_PROD
- Erm√∂glicht Nachverfolgung blockierter Auftr√§ge

---

### Phase 8: Produktion abgeschlossen

#### 8Ô∏è‚É£ Automatische Fertigstellung

**Trigger:** Letzter TimeSlot wird auf DONE gesetzt

**Bedingung:**
```
ALLE TimeSlots = DONE
UND
KEINE TimeSlots = BLOCKED
```

**Status-Wechsel:** `IN_PROD` ‚Üí `FERTIG` (automatisch!)

**System-Logik:**
Diese Pr√ºfung l√§uft automatisch nach jedem `stopTimeSlot()`:
```typescript
// Nach jedem TimeSlot-Stop
await this.stopTimeSlot(id);
await this.checkAndCompleteOrder(orderId); // ‚Üê Automatisch!
```

**Keine manuelle Aktion erforderlich!**

---

### Phase 9: Auslieferung

#### 9Ô∏è‚É£ Ware ausliefern

**Wer:** Lagermitarbeiter oder Verkauf (Rolle: LAGER, SALES_OPS oder ADMIN)

**Wo:** Auftrag-Detail ‚Üí Button "Auslieferung erfassen"

**Status-Wechsel:** `FERTIG` ‚Üí `ZUR_ABRECHNUNG`

**Was wird erfasst:**
```
POST /api/orders/:id/deliver
‚Üí Lieferdatum
‚Üí Gelieferte Menge
‚Üí Notiz zur Lieferung
```

**System-Logik:**
```typescript
// Backend: server/storage.ts - deliverOrder()

await prisma.order.update({
  where: { id: orderId },
  data: {
    deliveredAt: data.deliveredAt,
    deliveredQty: data.deliveredQty,
    deliveredNote: data.deliveredNote,
    workflow: 'ZUR_ABRECHNUNG',
  }
});
```

**Nach der Auslieferung:**
- Auftrag erscheint in der Abrechnung (Tab "Offen")
- Buchhaltung kann abrechnen

---

### Phase 10: Abrechnung

#### üîü Auftrag abrechnen

**Wer:** Buchhaltung (Rolle: ACCOUNTING oder ADMIN)

**Wo:** Seite "Abrechnung" ‚Üí Tab "Offen"

**Aktion:** Button "Abrechnen" klicken

**Status-Wechsel:** `ZUR_ABRECHNUNG` ‚Üí `ABGERECHNET`

**Validierung:**
```typescript
// Backend: server/storage.ts - settleOrder()

if (order.workflow !== 'ZUR_ABRECHNUNG') {
  throw new Error('Order must be in ZUR_ABRECHNUNG status');
}
```

**Was wird gespeichert:**
```typescript
await prisma.order.update({
  where: { id: orderId },
  data: {
    settledAt: new Date(),
    settledBy: userId, // Wer hat abgerechnet?
    workflow: 'ABGERECHNET',
  }
});
```

**Nach der Abrechnung:**
- Auftrag erscheint im Tab "Abgerechnet"
- Workflow ist abgeschlossen ‚úÖ

---

## üìà Status-√úbersichts-Diagramm

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    AUFTRAGSERSTELLUNG                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   NEU (Entwurf)  ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ  Daten erfassen:  ‚îÇ
                    ‚îÇ  - Positionen     ‚îÇ
                    ‚îÇ  - Gr√∂√üentabelle  ‚îÇ
                    ‚îÇ  - Assets         ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                 ‚îÇ "In Produktion geben"   ‚îÇ
                 ‚îÇ  (Submit + Validierung) ‚îÇ
                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    PRODUKTIONSPLANUNG                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   FUER_PROD      ‚îÇ
                    ‚îÇ (F√ºr Produktion) ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ TimeSlots planen  ‚îÇ
                    ‚îÇ Status: PLANNED   ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ  TimeSlot starten ‚îÇ
                    ‚îÇ  (Play-Button)    ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                       PRODUKTION                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ     IN_PROD      ‚îÇ
                    ‚îÇ (In Produktion)  ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                ‚îÇ             ‚îÇ             ‚îÇ
                ‚ñº             ‚ñº             ‚ñº
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ  PAUSED  ‚îÇ  ‚îÇ RUNNING  ‚îÇ  ‚îÇ  DONE    ‚îÇ
         ‚îÇ(Pausiert)‚îÇ  ‚îÇ (L√§uft)  ‚îÇ  ‚îÇ(Fertig)  ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ             ‚îÇ             ‚îÇ
                ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   Problem?        ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ  Ja: Fehlteile    ‚îÇ
                    ‚îÇ  TimeSlot:BLOCKED ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                  ‚îÇ  WARTET_FEHLTEILE      ‚îÇ
                  ‚îÇ (Wartet auf Fehlteile) ‚îÇ
                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ  Freigeben        ‚îÇ
                    ‚îÇ  (zur√ºck zu       ‚îÇ
                    ‚îÇ   FUER_PROD)      ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                  ‚îÇ Alle TimeSlots DONE &  ‚îÇ
                  ‚îÇ keine BLOCKED          ‚îÇ
                  ‚îÇ ‚Üí Automatisch!         ‚îÇ
                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                               ‚îÇ
                               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                       ABSCHLUSS                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                               ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ     FERTIG       ‚îÇ
                    ‚îÇ(Produktion fertig)‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                               ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ Auslieferung erfassen‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                               ‚îÇ
                               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                       ABRECHNUNG                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                               ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ  ZUR_ABRECHNUNG  ‚îÇ
                    ‚îÇ(Ausgabe erfolgt) ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                               ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   Abrechnen         ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                               ‚îÇ
                               ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ  ABGERECHNET     ‚îÇ
                    ‚îÇ  (Abgeschlossen) ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                               ‚îÇ
                               ‚ñº
                          ‚úÖ FERTIG
```

---

## ‚öôÔ∏è Technische Details

### TimeSlot-Status

| Status | Beschreibung | M√∂gliche Aktionen |
|--------|--------------|-------------------|
| `PLANNED` | Geplant, noch nicht gestartet | Start |
| `RUNNING` | L√§uft aktuell | Pause, Stop |
| `PAUSED` | Pausiert | Start (fortsetzen), Stop |
| `DONE` | Abgeschlossen | QC setzen |
| `BLOCKED` | Blockiert wegen Fehlteilen | - |

### Status-Maschine (State Machine)

```typescript
// Erlaubte √úberg√§nge f√ºr TimeSlots

PLANNED ‚Üí RUNNING  // Start
RUNNING ‚Üí PAUSED   // Pause
PAUSED ‚Üí RUNNING   // Fortsetzen
RUNNING ‚Üí DONE     // Stop
PAUSED ‚Üí DONE      // Stop
* ‚Üí BLOCKED        // Problem melden
```

**Ung√ºltige √úberg√§nge f√ºhren zu HTTP 422 Fehler!**

### Rollen-basierte Berechtigungen

| Rolle | Auftr√§ge | Planung | Produktion | Abrechnung | Lager |
|-------|----------|---------|------------|------------|-------|
| `ADMIN` | ‚úÖ Alle | ‚úÖ Alle | ‚úÖ Alle | ‚úÖ Alle | ‚úÖ Alle |
| `PROD_PLAN` | ‚ùå | ‚úÖ Planen | ‚ùå | ‚ùå | ‚ùå |
| `PROD_RUN` | ‚ùå | ‚ùå | ‚úÖ Ausf√ºhren | ‚ùå | ‚ùå |
| `SALES_OPS` | ‚úÖ Verwalten | ‚ùå | ‚ùå | ‚ùå | ‚ùå |
| `ACCOUNTING` | ‚ùå | ‚ùå | ‚ùå | ‚úÖ Abrechnen | ‚ùå |
| `LAGER` | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚úÖ Verwalten |

---

## üéØ H√§ufige Fragen

### Warum kann ich meinen Auftrag nicht in Produktion geben?

**Checkliste:**
1. ‚úÖ Mindestens 1 Position vorhanden?
2. ‚úÖ (TEAMSPORT) Gr√∂√üentabelle erstellt?
3. ‚úÖ (TEAMSPORT) Mindestens 1 PRINT-Asset hochgeladen?
4. ‚úÖ (TEAMSPORT) Asset als "Erforderlich f√ºr Freigabe" markiert?

**H√§ufigster Fehler:**
Assets wurden hochgeladen, aber das H√§kchen "Erforderlich f√ºr Freigabe" wurde NICHT gesetzt!

### Wann wechselt ein Auftrag automatisch auf FERTIG?

**Bedingung:**
- ALLE TimeSlots haben Status `DONE`
- UND keine TimeSlots haben Status `BLOCKED`

**Pr√ºfung erfolgt automatisch nach jedem TimeSlot-Stop!**

### Kann ich einen TimeSlot l√∂schen?

Aktuell nicht implementiert. TimeSlots k√∂nnen pausiert oder gestoppt werden.

### Was passiert mit JTL-Auftr√§gen?

JTL-Auftr√§ge haben Quelle `JTL` statt `INTERNAL`:
- Sind schreibgesch√ºtzt f√ºr Stammdaten
- K√∂nnen Gr√∂√üentabelle und Assets erhalten
- Workflow l√§uft identisch zu internen Auftr√§gen

---

## üìù Zusammenfassung

### Der komplette Weg eines Auftrags:

1. **Erstellen** ‚Üí Status: `NEU`
2. **Daten erfassen** ‚Üí Positionen, Gr√∂√üentabelle, Assets
3. **Freigeben** ‚Üí Status: `FUER_PROD` (mit Validierung!)
4. **Planen** ‚Üí TimeSlots erstellen
5. **Starten** ‚Üí Status: `IN_PROD`, TimeSlot: `RUNNING`
6. **Produzieren** ‚Üí Pause/Stop m√∂glich
7. **Bei Problemen** ‚Üí Status: `WARTET_FEHLTEILE`
8. **Automatische Fertigstellung** ‚Üí Status: `FERTIG`
9. **Ausliefern** ‚Üí Status: `ZUR_ABRECHNUNG`
10. **Abrechnen** ‚Üí Status: `ABGERECHNET` ‚úÖ

### Wichtigste automatische Logik:

- ‚ú® **Auto-Complete:** Auftrag wird automatisch FERTIG wenn alle TimeSlots DONE
- ‚ú® **Status-Wechsel:** IN_PROD wird automatisch gesetzt beim ersten TimeSlot-Start
- ‚ú® **Validierung:** Submit-Button pr√ºft automatisch alle Voraussetzungen

---

**Stand:** Oktober 2025  
**Version:** 1.0
